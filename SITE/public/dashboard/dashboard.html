<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="shortcut icon" href="../assets/icon/favicon2.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elden Ring | Build</title>

    <link rel="icon" href="../IMAGENS/icon.png">
    <link rel="stylesheet" href="../css/dashboards.css" />
    <!-- scripts do Chart.js - 2022-1 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!--FONT AWESOME-->
    <script src="https://kit.fontawesome.com/9f7414eb10.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div id="div_loading" style="display: none;">
        <img src="../IMAGENS/telaLoading.jpeg" alt="">
        <p id="p"></p>
        <hr id="hr">
    </div>
    <div id="dashboard">
        <nav id="telaLateral" style="display: none;">
            <div class="lateral">
                <img src="./imagens/elden-ring-logo.png" alt="">
            </div>
            <div class="telas">
                <p>Olá, <span id="b_usuario"></span></p>
                <a href="../index.html">HOME</a>
                <a href="./classes.html">CLASSES</a>
                <a href="../index.html" onclick="deslogar()">SAIR</a>
            </div>
            <div class="sair">
                <button onclick="fecharLateral()">FECHAR <span>&#10095;</span></button>
            </div>
        </nav>
        <div class="tela-principal" id="telaPrincipal">
            <div class="header">
                <img src="./imagens/barras.png" alt="" onclick="abriLateral()">
                <div class="titulo">
                    <p>MONTE SUA BUILD</p>
                </div>
            </div>
            <div class="classes">
                <button class="voltar" onclick="voltar()">&#10094;</button>
                <div class="carrossel box1" id="box1" id="carrossel">
                    <img src="imagens/PRINTS/miseravel.png" id="img_miseravel" onclick="destacar(0, 'Miseravel')"
                        alt="Imagem das classes">
                    <img src="imagens/PRINTS/andarilho.png" id="img_andarilho" onclick="destacar(1, 'Andarilho')"
                        alt="Imagem das classes">
                    <img src="imagens/PRINTS/astrologo.png" id="img_astrologo" onclick="destacar(2, 'Astrologo')"
                        alt="Imagem das classes">
                </div>
                <div class="carrossel box2" id="box2" style="display: none;" id="carrossel">
                    <img src="imagens/PRINTS/bandido.png" id="img_bandido" onclick="destacar(3, 'Bandido')"
                        alt="Imagem das classes">
                    <img src="imagens/PRINTS/confessor.png" id="img_confessor" onclick="destacar(4, 'Confessor')"
                        alt="Imagem das classes">
                    <img src="imagens/PRINTS/guerreiro.png" id="img_guerreiro" onclick="destacar(5, 'Guerreiro')"
                        alt="Imagem das classes">
                </div>
                <div class="carrossel box3" id="box3" style="display: none;" id="carrossel">
                    <img src="imagens/PRINTS/heroi.png" id="img_heroi" onclick="destacar(6, 'Heroi')"
                        alt="Imagem das classes">
                    <img src="imagens/PRINTS/prisioneiro.png" id="img_prisioneiro" onclick="destacar(7, 'Prisioneiro')"
                        alt="Imagem das classes">
                    <img src="imagens/PRINTS/profeta.png" id="img_profeta" onclick="destacar(8, 'Profeta')"
                        alt="Imagem das classes">
                </div>
                <div class="carrossel box4" id="box4" style="display: none;" id="carrossel">
                    <img src="imagens/PRINTS/samurai.png" id="img_samurai" onclick="destacar(9, 'Samurai')"
                        alt="Imagem das classes">
                </div>
                <button class="seguir" onclick="seguir()">&#10095;</button>
            </div>
            <div class="container">
                <div class="atributos">
                    <div class="atributo">
                        <div class="atrb">
                            <h3>Vigor</h3>
                        </div>
                        <input oninput="alterarValorInput(0)" type="text" id="input_vigor" inputmode="numeric"
                            class="valor-atrb" maxlength="2" min="9" value="9">
                        <p class="mais-menos" onclick="decrementar(0)">-</p>
                        <div class="barra">
                            <input oninput="alterarValorRange(0)" type="range" id="range_vigor" value="9" min="9"
                                max="99">
                            <div class="min-max">
                                <p>9</p>
                                <p>99</p>
                            </div>
                        </div>
                        <p class="mais-menos" onclick="incrementar(0)">+</p>
                    </div>
                    <div class="atributo">
                        <div class="atrb">
                            <h3>Mente</h3>
                        </div>
                        <input oninput="alterarValorInput(1)" type="text" id="input_mente" inputmode="numeric"
                            class="valor-atrb" maxlength="2" min="9" value="9">
                        <p class="mais-menos" onclick="decrementar(1)">-</p>
                        <div class="barra">
                            <input oninput="alterarValorRange(1)" type="range" id="range_mente" value="9" min="9"
                                max="99">
                            <div class="min-max">
                                <p>9</p>
                                <p>99</p>
                            </div>
                        </div>
                        <p class="mais-menos" onclick="incrementar(1)">+</p>
                    </div>
                    <div class="atributo">
                        <div class="atrb">
                            <h3>Resistência</h3>
                        </div>
                        <input oninput="alterarValorInput(2)" type="text" id="input_resistencia" inputmode="numeric"
                            class="valor-atrb" maxlength="2" min="8" value="8">
                        <p class="mais-menos" onclick="decrementar(2)">-</p>
                        <div class="barra">
                            <input oninput="alterarValorRange(2)" type="range" id="range_resistencia" value="8" min="8"
                                max="99">
                            <div class="min-max">
                                <p>8</p>
                                <p>99</p>
                            </div>
                        </div>
                        <p class="mais-menos" onclick="incrementar(2)">+</p>
                    </div>
                    <div class="atributo">
                        <div class="atrb">
                            <h3>Força</h3>
                        </div>
                        <input oninput="alterarValorInput(3)" type="text" id="input_forca" inputmode="numeric"
                            class="valor-atrb" maxlength="2" min="8" value="8">
                        <p class="mais-menos" onclick="decrementar(3)">-</p>
                        <div class="barra">
                            <input oninput="alterarValorRange(3)" type="range" id="range_forca" value="8" min="8"
                                max="99">
                            <div class="min-max">
                                <p>8</p>
                                <p>99</p>
                            </div>
                        </div>
                        <p class="mais-menos" onclick="incrementar(3)">+</p>
                    </div>
                    <div class="atributo">
                        <div class="atrb">
                            <h3>Destreza</h3>
                        </div>
                        <input oninput="alterarValorInput(4)" type="text" id="input_destreza" inputmode="numeric"
                            class="valor-atrb" maxlength="2" min="8" value="8">
                        <p class="mais-menos" onclick="decrementar(4)">-</p>
                        <div class="barra">
                            <input oninput="alterarValorRange(4)" type="range" id="range_destreza" value="8" min="8"
                                max="99">
                            <div class="min-max">
                                <p>8</p>
                                <p>99</p>
                            </div>
                        </div>
                        <p class="mais-menos" onclick="incrementar(4)">+</p>
                    </div>
                    <div class="atributo">
                        <div class="atrb">
                            <h3>Inteligência</h3>
                        </div>
                        <input oninput="alterarValorInput(5)" type="text" id="input_inteligencia" inputmode="numeric"
                            class="valor-atrb" maxlength="2" min="7" value="7">
                        <p class="mais-menos" onclick="decrementar(5)">-</p>
                        <div class="barra">
                            <input oninput="alterarValorRange(5)" type="range" id="range_inteligencia" value="7" min="7"
                                max="99">
                            <div class="min-max">
                                <p>7</p>
                                <p>99</p>
                            </div>
                        </div>
                        <p class="mais-menos" onclick="incrementar(5)">+</p>
                    </div>
                    <div class="atributo">
                        <div class="atrb">
                            <h3>Fé</h3>
                        </div>
                        <input oninput="alterarValorInput(6)" type="text" id="input_fe" inputmode="numeric"
                            class="valor-atrb" maxlength="2" min="6" value="6">
                        <p class="mais-menos" onclick="decrementar(6)">-</p>
                        <div class="barra">
                            <input oninput="alterarValorRange(6)" type="range" id="range_fe" value="6" min="6" max="99">
                            <div class="min-max">
                                <p>6</p>
                                <p>99</p>
                            </div>
                        </div>
                        <p class="mais-menos" onclick="incrementar(6)">+</p>
                    </div>
                    <div class="atributo">
                        <div class="atrb">
                            <h3>Arcano</h3>
                        </div>
                        <input oninput="alterarValorInput(7)" type="text" id="input_arcano" inputmode="numeric"
                            class="valor-atrb" maxlength="2" min="7" value="7">
                        <p class="mais-menos" onclick="decrementar(7)">-</p>
                        <div class="barra">
                            <input oninput="alterarValorRange(7)" type="range" id="range_arcano" value="7" min="7"
                                max="99">
                            <div class="min-max">
                                <p>7</p>
                                <p>99</p>
                            </div>
                        </div>
                        <p class="mais-menos" onclick="incrementar(7)">+</p>
                    </div>
                </div>
                <div class="upar">
                    <h1>Status do personagem!</h1>
                    <div class="up">
                        <div class="coluna">
                            <div class="item">
                                <span>Level:</span>
                                <div class="box" id="div_level">1</div>
                            </div>
                            <div class="item">
                                <span>Total de runas:</span>
                                <div class="box" id="div_runas">0</div>
                            </div>
                            <div class="item">
                                <span>HP:</span>
                                <div class="box" id="div_vida">414</div>
                            </div>
                        </div>
                        <div class="coluna">
                            <div class="item">
                                <span>Mana:</span>
                                <div class="box" id="div_mana">65</div>
                            </div>
                            <div class="item">
                                <span>Estamina:</span>
                                <div class="box" id="div_vigor">90</div>
                            </div>
                            <div class="item">
                                <span>Carregar equipamentos:</span>
                                <div class="box" id="div_peso">45</div>
                            </div>
                        </div>
                    </div>
                    <div class="botao">
                        <a href="#builds"><button onclick="verificarBuild()">Verificar build</button></a>
                    </div>
                </div>
            </div>
            <div id="builds" style="display: none;">
                <div class="arma">
                    <div id="forca" class="boxes" style="display: none;">
                        <h1>Espada Grande de Minério Meteórico (Meteoric Ore Blade)</h1>
                        <h2>Arma indicada para builds de Força</h2>
                        <img src="./imagens/forca.webp" alt="">
                        <p>Essa arma uma excelente opção para builds de Força, com dano híbrido (físico e mágico).</p>
                    </div>
                    <div id="int" class="boxes" style="display: none;">
                        <h1>Arma indicada para builds de Inteligência</h1>
                        <img src="./imagens/int.webp" alt="">
                        <h1> Espada Grande da Lua Negra (Dark Moon Greatsword)</h1>
                        <p>Essa arma é amplamente considerada a melhor arma para builds de Inteligência pura.</p>
                    </div>
                    <div id="dex" class="boxes" style="display: none;">
                        <h1>Arma indicada para builds de Destreza</h1>
                        <img src="./imagens/dex.webp" alt="">
                        <h1>Lâminas Gêmeas (Twinblades) </h1>
                        <p>Essa arma é ótima para o início do jogo e escalam bem com Destreza.</p>
                    </div>
                    <div id="fe" class="boxes" style="display: none;">
                        <h1>Arma indicada para builds de Fé</h1>
                        <img src="./imagens/fe.webp" alt="">
                        <h1> Espada Codificada (Cipher Pata)</h1>
                        <p>Essa arma é uma das melhores que escalam puramente com Fé, podendo atingir um escalonamento
                            de S com aprimoramentos.</p>
                    </div>
                    <div id="arc" class="boxes" style="display: none;">
                        <h1>Arma indicada para builds de Arcano</h1>
                        <img src="./imagens/arc.webp" alt="">
                        <h1>Reduvia (adaga)</h1>
                        <p>Para builds focadas em Arcano, as armas que causam sangramento (hemorrhage) são geralmente as
                            mais eficazes.</p>
                    </div>
                </div>
                <div class="grafico">
                    <div class="canvas">
                        <canvas id="grafico"></canvas>
                    </div>
                    <div class="botao">
                        <button onclick="salvar()">SALVAR BUILD</button>
                    </div>
                </div>
                <div class="x">
                    <img src="./imagens/x.png" alt="" onclick="fecharBuild()">
                </div>
                <div id="modalClasse" style="display: none;">
                    <div class="modal">
                        <h1>Qual será o nome da sua build:</h1>
                        <input type="text" id="apelido">
                        <div id="div_mensagem"></div>
                        <div class="botaoModal">
                            <button onclick="cadastrarBuild()">Salvar</button>
                            <button onclick="fecharTela()">Fechar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>

<script>
    window.onload = loading();
    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
    function deslogar(){
        sessionStorage.clear()
    }
    
    var classeEscolhida = '';
    var tamanho = 0;
    var porcentagem = 0;
    var level = 0;

    var imagens = [
        document.getElementById('img_miseravel'),
        document.getElementById('img_andarilho'),
        document.getElementById('img_astrologo'),
        document.getElementById('img_bandido'),
        document.getElementById('img_confessor'),
        document.getElementById('img_guerreiro'),
        document.getElementById('img_heroi'),
        document.getElementById('img_prisioneiro'),
        document.getElementById('img_profeta'),
        document.getElementById('img_samurai')
    ];

    var range = [
        document.getElementById('range_vigor'),
        document.getElementById('range_mente'),
        document.getElementById('range_resistencia'),
        document.getElementById('range_forca'),
        document.getElementById('range_destreza'),
        document.getElementById('range_inteligencia'),
        document.getElementById('range_fe'),
        document.getElementById('range_arcano')
    ];

    var input = [
        document.getElementById('input_vigor'),
        document.getElementById('input_mente'),
        document.getElementById('input_resistencia'),
        document.getElementById('input_forca'),
        document.getElementById('input_destreza'),
        document.getElementById('input_inteligencia'),
        document.getElementById('input_fe'),
        document.getElementById('input_arcano')
    ];

    var build = ['Vigor', 'Mana', 'Res', 'Força', 'Dex', 'Int', 'Fe', 'Arc'];
    var atrb = [];

    function salvar() {
        modalClasse.style.display = 'flex'
    }

    function fecharTela() {
        modalClasse.style.display = 'none'
    }

    function loading() {
        div_loading.style.display = 'flex';
        dashboard.style.display = 'none';
        carregar()
    }
    function carregar() {
        tamanho += 2.9;
        porcentagem += 3;
        hr.style.width = `${tamanho}%`
        p.innerHTML = `${porcentagem}%`;

        setTimeout(() => {
            carregar()
        }, "80");

        setTimeout(() => {
            fecharModal()
        }, "2700");
    }

    function destacar(indiceImagem, nomeClasse) {
        for (var i = 0; i < imagens.length; i++) {
            var img_atual = imagens[i];
            img_atual.style.filter = 'grayscale(100%)'
        }
        imagens[indiceImagem].style.filter = 'grayscale(0%)'
        classeEscolhida = nomeClasse;
    }

    function abriLateral() {
        telaLateral.style.display = 'flex';
        telaPrincipal.style.width = '85%';
        passar.style.width = '85%';
    }

    function fecharLateral() {
        telaLateral.style.display = 'none';
        telaPrincipal.style.width = '100%';
        passar.style.width = '100%';
    }

    function fecharModal() {
        div_loading.style.display = 'none';
        dashboard.style.display = 'flex';
    }

    function seguir() {
        if (box1.style.display == 'flex') {
            box1.style.display = 'none'
            box2.style.display = 'flex'
        } else if (box2.style.display == 'flex') {
            box2.style.display = 'none'
            box3.style.display = 'flex'
        } else if (box3.style.display == 'flex') {
            box3.style.display = 'none'
            box4.style.display = 'flex'
        } else {
            box1.style.display = 'flex'
            box4.style.display = 'none'
        }
    }

    function voltar() {
        if (box4.style.display == 'flex') {
            box4.style.display = 'none'
            box3.style.display = 'flex'
        } else if (box3.style.display == 'flex') {
            box3.style.display = 'none'
            box2.style.display = 'flex'
        } else if (box2.style.display == 'flex') {
            box2.style.display = 'none'
            box1.style.display = 'flex'
        } else {
            box4.style.display = 'flex'
            box1.style.display = 'none'
        }
    }

    function verificarBuild() {
        if (classeEscolhida == '') {
            alert('Escolha uma classe para prosseguir com a build')
        } else {
            var valor = 0;
            var maiorAtributo = 8;
            var buildAtual = '';
            var j = 0;

            for (var i = 0; i < input.length; i++) {
                valor = Number(input[i].value);
                if (valor >= maiorAtributo) {
                    buildAtual = build[j];
                    maiorAtributo = valor;
                }
                j++;
            }
            builds.style.display = 'flex'

            if (buildAtual == 'Força') {
                forca.style.display = 'block'
            } else if (buildAtual == 'Int') {
                int.style.display = 'block'
            } else if (buildAtual == 'Dex') {
                dex.style.display = 'block'
            } else if (buildAtual == 'Fe') {
                fe.style.display = 'block'
            } else if (buildAtual == 'Arc') {
                arc.style.display = 'block'
            }
        }
    }

    function fecharBuild() {
        builds.style.display = 'none'
        forca.style.display = 'none'
        int.style.display = 'none'
        dex.style.display = 'none'
        fe.style.display = 'none'
        arc.style.display = 'none'

    }

    function incrementar(indiceAtrb) {
        if (input[indiceAtrb].value < 99) {
            range[indiceAtrb].value = Number(range[indiceAtrb].value) + 1;
            input[indiceAtrb].value = Number(input[indiceAtrb].value) + 1;
        }
        subirNivel()
        attGrafico()
    }

    function decrementar(indiceAtrb) {
        var valorAtual = Number(input[indiceAtrb].value);
        var valorMin = Number(input[indiceAtrb].min);
        if (valorAtual > valorMin) {
            range[indiceAtrb].value = Number(range[indiceAtrb].value) - 1;
            input[indiceAtrb].value = Number(input[indiceAtrb].value) - 1;
        }
        subirNivel()
        attGrafico()
    }

    function alterarValorRange(indiceAtrb) {
        input[indiceAtrb].value = range[indiceAtrb].value;
        subirNivel()
        attGrafico()
    }

    function alterarValorInput(indiceAtrb) {
        range[indiceAtrb].value = input[indiceAtrb].value;
        subirNivel()
        attGrafico()
    }

    function subirNivel() {
        level = 0;
        var vida = Number(input[0].value);
        var mente = Number(input[1].value);
        var vigor = Number(input[2].value);

        if (vida > 9) {
            div_vida.innerHTML = (17 * vida) + 414;
        }

        if (mente > 9) {
            div_mana.innerHTML = (4 * mente) + 65;
        }

        if (vigor > 9) {
            div_vigor.innerHTML = (vigor + vigor) + 90;
            div_peso.innerHTML = (vigor * 1.25) + 45;
        }

        for (var i = 0; i < input.length; i++) {
            level += Number(input[i].value);
        }
        div_level.innerHTML = level - 61;
        div_runas.innerHTML = level * 2315403;

    }

    function attGrafico() {
        atrb[0] = Number(input[0].value);
        atrb[1] = Number(input[1].value);
        atrb[2] = Number(input[2].value);
        atrb[3] = Number(input[3].value);
        atrb[4] = Number(input[4].value);
        atrb[5] = Number(input[5].value);
        atrb[6] = Number(input[6].value);
        atrb[7] = Number(input[7].value);
    }

    var grafico = document.getElementById('grafico');

    new Chart(grafico, {
        type: 'radar',
        data: {
            labels: build,
            datasets: [{
                label: 'Build',
                data: atrb,
                borderWidth: 3,
                backgroundColor: "rgba(0, 123, 255, 0.35)",
                borderColor: "#4dabff",
                pointBackgroundColor: "#4dabff"
            }]
        },
        options: {
            plugins: {
                legend: {
                    labels: {
                        color: "#fff"
                    }
                }
            },
            scales: {
                r: {
                    min: 0,
                    max: 100,
                    ticks: {
                        display: false,

                    },
                    pointLabels: {
                        color: "#fff",
                        font: {
                            size: 20
                        }
                    },
                    grid: {
                        color: "rgba(255,255,255,0.25)"
                    },
                    angleLines: {
                        color: "rgba(255,255,255,0.25)"
                    }
                }
            }
        }
    });

    function cadastrarBuild() {
        var nome = apelido.value;
        var classe = classeEscolhida;
        var nivel = level + 1;
        var vigor = atrb[0] = Number(input[0].value);
        var Mana = atrb[1] = Number(input[1].value);
        var Res = atrb[2] = Number(input[2].value);
        var Forca = atrb[3] = Number(input[3].value);
        var Dex = atrb[4] = Number(input[4].value);
        var Int = atrb[5] = Number(input[5].value);
        var Fe = atrb[6] = Number(input[6].value);
        var Arc = atrb[7] = Number(input[7].value);
        var fkUsuario = sessionStorage.ID_USUARIO;

        if(nivel > 61){
            nivel -= 61;
        }

        fetch("/build/cadastrarBuild", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                nomeServer: nome,
                classeServer: classe,
                nivelServer: nivel,
                vigorServer: vigor,
                ManaServer: Mana,
                ResServer: Res,
                ForcaServer: Forca,
                DexServer: Dex,
                IntServer: Int,
                FeServer: Fe,
                ArcServer: Arc,
                fkUsuarioServer: fkUsuario
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {

                    div_mensagem.innerHTML = 'Build salva com sucesso, indo para dashboard';
                    setTimeout(function () {
                        window.location = "./classes.html";
                    }, 1500);
                } else {
                    throw "Houve um erro ao tentar salvar a classe!";
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });

        return false;
    }
</script>